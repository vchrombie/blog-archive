{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/cd-with-gha","result":{"data":{"post":{"__typename":"MdxPost","slug":"/cd-with-gha","title":"Continuous Delivery with GitHub Actions","date":"16.02.2021","tags":[{"name":"GrimoireLab","slug":"grimoire-lab"}],"description":null,"canonicalUrl":null,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Continuous Delivery with GitHub Actions\",\n  \"date\": \"2021-02-16T00:00:00.000Z\",\n  \"tags\": [\"GrimoireLab\"],\n  \"slug\": \"cd-with-gha\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"This post would talk discuss how we have set up the Continuous Delivery system using GitHub Actions. This is a continuation post of \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://vchrombie.github.io/blog/ci-with-gha\"\n  }, \"Continuous Integration with GitHub Actions\"), \".\"), mdx(\"p\", null, \"Continuous delivery (CD) is an approach to software engineering based on producing software in short cycles. We want to generate the GrimoireLab releases very frequently but updating all the PyPI images manually is a big task. We wanted to use GitHub Actions to do this job. Whenever a new tag is produced, the project has to be built and published to PyPI.\"), mdx(\"p\", null, \"We were planning to migrate to using Poetry for managing the GrimoireLab project for a long time. \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/python-poetry/poetry\"\n  }, \"Poetry\"), \" is a tool to handle dependency installation as well as building and packaging Python packages. It makes the tasks simple so, we worked on adding the support for Poetry to all the GrimoireLab tools.\"), mdx(\"p\", null, \"We need to install \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://python-poetry.org/docs/#installation\"\n  }, \"Poetry\"), \", and later we can use the below commands to convert any project to a poetry-based project.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"poetry init\"), \" would initialize a project, you are expected to fill the required fields, and later generates the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"pyproject.toml\"), \" file. \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"poetry add package_name\"), \" would add the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"package_name\"), \" as the main dependency, whereas \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"poetry add -D package_name\"), \" would add the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"package_name\"), \" as a developer dependency.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ poetry init\\n$ poetry add `cat requirements.txt`\\n$ poetry add -D `cat requirements_tests.txt`\\n\")), mdx(\"p\", null, \"You can add additional fields which might be needed according to the project like classifiers, packages, license in the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"pyproject.toml\"), \" file. You can find the whole list in the documentation, \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://python-poetry.org/docs/pyproject/\"\n  }, \"The pyproject.toml file\"), \".\"), mdx(\"p\", null, \"Once the pyproject.toml is configured correctly, you can install the project using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"poetry install\"), \". This would create a virtual environment and it can be activated using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"poetry shell\"), \".\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ poetry install\\n$ poetry shell\\n\")), mdx(\"p\", null, \"We can build the package using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"poetry build\"), \", this would create the wheel and tar packages in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"dist\"), \" folder. Later, we can use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"poetry publish\"), \" to publish these wheel packages to PyPI directly. Make sure you have configured the PyPI token accordingly.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ poetry build\\n$ poetry publish\\n\")), mdx(\"p\", null, \"Now that we have the required setup and the steps, it is quite easy to create a github actions for publising the packages to PyPI. We created the below github action for the same purpose.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"jobs:\\n\\n  build:\\n    runs-on: ubuntu-latest\\n    steps:\\n      - uses: actions/checkout@v2\\n      - name: Set up Python\\n        uses: actions/setup-python@v2\\n        with:\\n          python-version: '3.x'\\n      - name: Install poetry\\n        run: curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python\\n      - name: Build distributions\\n        run: poetry build\\n      - name: Upload distribution artifacts\\n        uses: actions/upload-artifact@v2\\n        with:\\n          name: rt-dist\\n          path: dist\\n\\n  publish:\\n    needs: [build]\\n    runs-on: ubuntu-latest\\n    steps:\\n      - uses: actions/checkout@v2\\n      - name: Download distribution artifact\\n        uses: actions/download-artifact@v2\\n        with:\\n          name: rt-dist\\n          path: dist\\n      - name: Set up Python\\n        uses: actions/setup-python@v2\\n        with:\\n          python-version: '3.x'\\n      - name: Install poetry\\n        run: curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python\\n      - name: Configure pypi credentials\\n        env:\\n          PYPI_API_TOKEN: ${{ secrets.PYPI_API_TOKEN }}\\n        run: poetry config http-basic.pypi __token__ \\\"$PYPI_API_TOKEN\\\"\\n      - name: Publish release to pypi\\n        run: poetry publish\\n\")), mdx(\"p\", null, \"The action needs to be triggered whenever a release is made. A release tag (eg. 0.1.12) is generated and pushed to the repository whenever the maintainer publishes a release. This can be added as a rule in the github actions.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"on:\\n  push:\\n    tags: \\n      - '*.*.*'\\n\")), mdx(\"p\", null, \"We have tested this on a couple of repositories and it worked like a charm. We have some plans to expand this to create a full automatic release workflow system to manage and create releases. I will come up with another blog post soon about it.\"), mdx(\"p\", null, \"~ Venu\\n\\uD83D\\uDC4B\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"This post would talk discuss how we have set up the Continuous Delivery system using GitHub Actions. This is a continuation post ofâ€¦","timeToRead":2,"banner":null}},"pageContext":{"slug":"/cd-with-gha","formatString":"DD.MM.YYYY"}},"staticQueryHashes":["3090400250","3090400250","318001574"]}